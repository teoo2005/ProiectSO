#!/bin/bash

echo "Introduceți numele de utilizator pentru autentificare:"
read username

# Căutăm utilizatorul în fișierul utilizatori.csv
user_line=$(grep "^$username," utilizatori.csv)

if [ -z "$user_line" ]; then
    echo "Utilizatorul $username nu există."
    exit 1
fi

# Extragem parola criptată din fișierul CSV
stored_password_hash=$(echo $user_line | sed 's/^[^,]*,[^,]*,[^,]*,\([^,]*\),.*$/\1/')

# Solicităm parola
echo "Introduceți parola:"
read -s password

# Criptăm parola introdusă
password_hash=$(echo -n "$password" | sha256sum | sed 's/^\([a-f0-9]\{64\}\)\s.*$/\1/')

# Verificăm dacă hash-ul parolei este corect
if [ "$password_hash" != "$stored_password_hash" ]; then
    echo "Parola incorectă."
    exit 1
fi

# Dacă parola este corectă, actualizăm câmpul last_login
current_time=$(date '+%Y-%m-%d %H:%M:%S')
sed -i "s/^$username,[^,]*,[^,]*,[^,]*$/&,$current_time/" utilizatori.csv

# Navigăm către directorul home al utilizatorului
user_id=$(echo $user_line | sed 's/^\([^,]*\),.*$/\1/')
mkdir -p "/home/$user_id"
echo "Autentificare reușită! Veți fi direcționat către directorul home."
cd "/home/$user_id"
